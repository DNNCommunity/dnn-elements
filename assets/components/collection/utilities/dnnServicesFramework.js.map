{"version":3,"file":"dnnServicesFramework.js","sourceRoot":"","sources":["../../src/utilities/dnnServicesFramework.ts"],"names":[],"mappings":"AASA,MAAM,OAAO,oBAAoB;EAI7B;;KAEG;EACH,YAAY,QAAgB;IAI5B,mBAAc,GAAG,CAAC,UAAkB,EAAE,EAAE;MAEpC,IAAI,WAAW,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;MAC5D,WAAW,IAAI,MAAM,GAAG,UAAU,GAAG,GAAG,CAAC;MACzC,OAAO,WAAW,CAAC;IACvB,CAAC,CAAA;IAED,aAAQ,GAAG,GAAG,EAAE;MACZ,IAAI,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;MACpD,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAA;IAED,gBAAW,GAAG,GAAG,EAAE;MACf,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC,CAAA;IAED,wBAAmB,GAAG,GAAG,EAAE;MACvB,MAAM,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,wCAAwC,CAAqB,CAAC;MAChG,IAAI,EAAE,IAAI,IAAI,EAAC;QACX,OAAO,EAAE,CAAC,KAAK,CAAC;OACnB;WACG;QACA,OAAO,IAAI,CAAC;OACf;IACL,CAAC,CAAA;IAED,qBAAgB,GAAG,GAAG,EAAE;MACpB,IAAI,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;MAC5B,IAAI,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,EAAC;QACrB,OAAO,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;QACtD,OAAO,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;OACvD;MACD,MAAM,OAAO,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;MAC3C,IAAI,OAAO,IAAI,IAAI,EAAC;QAChB,OAAO,CAAC,MAAM,CAAC,0BAA0B,EAAE,OAAO,CAAC,CAAC;OACvD;MACD,OAAO,OAAO,CAAC;IACnB,CAAC,CAAA;IAxCG,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;EAC9B,CAAC;CAwCJ","sourcesContent":["declare global {\r\n    interface Window {\r\n        dnn: {\r\n            //** Gets dnn variables from the page context *\r\n            getVar: (key: string, defaultValue: string) => string;\r\n        }\r\n    }\r\n}\r\n\r\nexport class DnnServicesFramework{\r\n    \r\n    private _moduleId: number;\r\n\r\n    /**\r\n     * Initializes the serivces framework\r\n     */\r\n    constructor(moduleId: number) {\r\n        this._moduleId = moduleId;\r\n    }\r\n\r\n    getServiceRoot = (moduleName: string) =>\r\n    {\r\n        var serviceRoot = window.top.dnn.getVar(\"sf_siteRoot\", \"/\");\r\n        serviceRoot += \"API/\" + moduleName + \"/\";\r\n        return serviceRoot;\r\n    }\r\n\r\n    getTabId = () => {\r\n        var tabId = window.top.dnn.getVar(\"sf_tabId\", \"-1\");\r\n        return parseInt(tabId);\r\n    }\r\n\r\n    getModuleId = () => {\r\n        return this._moduleId;\r\n    }\r\n\r\n    getAntiForgeryValue = () => {\r\n        const el = document.querySelector(\"input[name=__RequestVerificationToken]\") as HTMLInputElement;\r\n        if (el != null){\r\n            return el.value;\r\n        }\r\n        else{\r\n            return null;\r\n        }\r\n    }\r\n\r\n    getModuleHeaders = () => {\r\n        var headers = new Headers();\r\n        if (this.getTabId() > -1){\r\n            headers.append(\"ModuleId\", this._moduleId.toString());\r\n            headers.append(\"TabId\", this.getTabId().toString());\r\n        }\r\n        const afValue = this.getAntiForgeryValue();\r\n        if (afValue != null){\r\n            headers.append(\"RequestVerificationToken\", afValue);\r\n        }\r\n        return headers;\r\n    }\r\n}"]}