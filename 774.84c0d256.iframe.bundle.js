"use strict";(self.webpackChunk_dnncommunity_dnn_elements=self.webpackChunk_dnncommunity_dnn_elements||[]).push([[774],{"./dist/esm/dnn-image-cropper.entry.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{dnn_image_cropper:()=>DnnImageCropper});var CornerType,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./dist/esm/index-9dbb7028.js"),_mouseUtilities_e70a0dc3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./dist/esm/mouseUtilities-e70a0dc3.js");!function(CornerType){CornerType[CornerType.nw=0]="nw",CornerType[CornerType.ne=1]="ne",CornerType[CornerType.se=2]="se",CornerType[CornerType.sw=3]="sw"}(CornerType||(CornerType={}));const DnnImageCropper=class{constructor(hostRef){(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.r)(this,hostRef),this.imageCropChanged=(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.c)(this,"imageCropChanged",7),this.imageFileCropChanged=(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.c)(this,"imageFileCropChanged",7),hostRef.$hostElement$["s-ei"]?this.internals=hostRef.$hostElement$["s-ei"]:(this.internals=hostRef.$hostElement$.attachInternals(),hostRef.$hostElement$["s-ei"]=this.internals),this.defaultResx={capture:"Capture",dragAndDropFile:"Drag and drop an image",or:"or",takePicture:"Take a picture",uploadFile:"Upload an image",imageTooSmall:"The image you are attempting to upload does not meet the minimum size requirement of {width} pixels by {height} pixels. Please upload a larger image.",modalCloseText:"Close"},this.initializeCropBox=()=>{const imageRect=this.image.getBoundingClientRect(),wantedRatio=this.width/this.height;let newWidth,newHeight;imageRect.width/imageRect.height>wantedRatio?(newHeight=imageRect.height,newWidth=newHeight*wantedRatio):(newWidth=imageRect.width,newHeight=newWidth/wantedRatio);const newTop=(imageRect.height-newHeight)/2,newLeft=(imageRect.width-newWidth)/2;this.crop.style.top=`${Math.round(newTop)}px`,this.crop.style.left=`${Math.round(newLeft)}px`,this.crop.style.width=`${Math.round(newWidth)}px`,this.crop.style.height=`${Math.round(newHeight)}px`},this.handleCropMouseDown=event=>{event.stopPropagation(),event.preventDefault();const className=event.target.classList[0];switch(document.addEventListener("mouseup",this.handleImageCropFinished,!1),document.addEventListener("touchend",this.handleImageCropFinished,!1),className){case"crop":document.addEventListener("mousemove",this.handleCropDrag,!1),document.addEventListener("touchmove",this.handleCropDrag,!1),document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleCropDrag))),document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleCropDrag)));break;case"nw":document.addEventListener("mousemove",this.handleNwMouseMove,!1),document.addEventListener("touchmove",this.handleNwMouseMove,!1),document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleNwMouseMove))),document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleNwMouseMove)));break;case"ne":document.addEventListener("mousemove",this.handleNeMouseMove,!1),document.addEventListener("touchmove",this.handleNeMouseMove,!1),document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleNeMouseMove))),document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleNeMouseMove)));break;case"se":document.addEventListener("mousemove",this.handleSeMouseMove,!1),document.addEventListener("touchmove",this.handleSeMouseMove,!1),document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleSeMouseMove))),document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleSeMouseMove)));break;case"sw":document.addEventListener("mousemove",this.handleSwMouseMove,!1),document.addEventListener("touchmove",this.handleSwMouseMove,!1),document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleSwMouseMove))),document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleSwMouseMove)))}},this.handleImageCropFinished=_ev=>{this.emitImage(),document.removeEventListener("mouseup",this.handleImageCropFinished),this.previousTouch=void 0},this.handleNwMouseMove=event=>{this.handleCornerDrag(event,CornerType.nw)},this.handleNeMouseMove=event=>{this.handleCornerDrag(event,CornerType.ne)},this.handleSeMouseMove=event=>{this.handleCornerDrag(event,CornerType.se)},this.handleSwMouseMove=event=>{this.handleCornerDrag(event,CornerType.sw)},this.handleCornerDrag=(event,corner)=>{const wantedRatio=this.width/this.height,cropRect=this.crop.getBoundingClientRect(),imageRect=this.image.getBoundingClientRect();let newWidth,newHeight,newTop,newLeft,{movementX,movementY}=(0,_mouseUtilities_e70a0dc3_js__WEBPACK_IMPORTED_MODULE_1__.g)(event,this.previousTouch);switch(corner){case CornerType.nw:newWidth=cropRect.width-movementX,newHeight=cropRect.height-movementY;break;case CornerType.ne:newWidth=cropRect.width+movementX,newHeight=cropRect.height-movementY;break;case CornerType.se:newWidth=cropRect.width+movementX,newHeight=cropRect.height+movementY;break;case CornerType.sw:newWidth=cropRect.width-movementX,newHeight=cropRect.height+movementY}if(!isNaN(wantedRatio))switch(corner){case CornerType.nw:newHeight=newWidth/wantedRatio,newTop=cropRect.bottom-newHeight;break;case CornerType.se:newWidth=newHeight*wantedRatio;break;case CornerType.ne:newHeight=newWidth/wantedRatio,newTop=cropRect.bottom-newHeight;break;case CornerType.sw:newWidth=newHeight*wantedRatio,newLeft=cropRect.right-newWidth}switch(corner){case CornerType.nw:newTop=this.crop.offsetTop+(cropRect.height-newHeight),newLeft=this.crop.offsetLeft+(cropRect.width-newWidth);break;case CornerType.ne:newTop=this.crop.offsetTop+(cropRect.height-newHeight),newLeft=this.crop.offsetLeft;break;case CornerType.se:newTop=this.crop.offsetTop,newLeft=this.crop.offsetLeft;break;case CornerType.sw:newTop=this.crop.offsetTop,newLeft=this.crop.offsetLeft+(cropRect.width-newWidth)}if(newLeft<0&&(newWidth+=newLeft,newLeft=0),newTop<0&&(newHeight+=newTop,newTop=0),newLeft+newWidth>imageRect.width&&(newWidth=imageRect.width-newLeft),newTop+newHeight>imageRect.height&&(newHeight=imageRect.height-newTop),!isNaN(wantedRatio))switch(corner){case CornerType.se:case CornerType.sw:newWidth=newHeight*wantedRatio,newLeft+newWidth>imageRect.width&&(newWidth=imageRect.width-newLeft,newHeight=newWidth/wantedRatio)}if(this.preventUndersized){const zoomRatio=this.image.width/this.image.naturalWidth;if(newWidth/zoomRatio<this.width||newHeight/zoomRatio<this.height)return}this.crop.style.top=`${newTop}px`,this.crop.style.left=`${newLeft}px`,this.crop.style.width=`${newWidth}px`,this.crop.style.height=`${newHeight}px`},this.handleCropDrag=ev=>{if(!this.isMouseStillInTarget(ev))return;let{movementX,movementY}=(0,_mouseUtilities_e70a0dc3_js__WEBPACK_IMPORTED_MODULE_1__.g)(ev,this.previousTouch),newLeft=this.crop.offsetLeft+movementX,newTop=this.crop.offsetTop+movementY;var imageRect=this.image.getBoundingClientRect(),cropRect=this.crop.getBoundingClientRect();newLeft<0&&(newLeft=0),newTop<0&&(newTop=0),newLeft+cropRect.width>imageRect.width&&(newLeft=this.crop.offsetLeft),newTop+cropRect.height>imageRect.height&&(newTop=this.crop.offsetTop),this.crop.style.left=newLeft+"px",this.crop.style.top=newTop+"px"},this.width=void 0,this.height=void 0,this.resx=void 0,this.quality=.8,this.preventUndersized=!1,this.name=void 0,this.view=void 0,this.localResx=void 0,this.fileName=void 0,this.focused=!1}async clear(){this.setView("noPictureView")}componentWillLoad(){this.mergeResx()}componentDidLoad(){requestAnimationFrame((()=>{this.setView("noPictureView")}))}resxChanged(){this.mergeResx()}formResetCallback(){this.clear(),this.internals.setValidity({}),this.internals.setFormValue("")}mergeResx(){this.localResx=Object.assign(Object.assign({},this.defaultResx),this.resx)}setView(newView){switch(this.host.shadowRoot.querySelectorAll(".view").forEach((v=>v.classList.remove("visible"))),newView){case"noPictureView":this.noPictureView.classList.add("visible");break;case"hasPictureView":this.hasPictureView.classList.add("visible")}this.view=newView}initCrop(){this.crop.style.top="0px",this.crop.style.left="0px",this.crop.style.width="100%",this.crop.style.height="100%";var wantedRatio=this.width/this.height,imageRect=this.image.getBoundingClientRect();if(wantedRatio>imageRect.width/imageRect.height){var wantedHeight=imageRect.width/wantedRatio,diff=imageRect.height-wantedHeight;this.crop.style.top=Math.round(diff/2).toString()+"px",this.crop.style.height=Math.round(wantedHeight).toString()+"px"}else{var wantedWidth=imageRect.height*wantedRatio;diff=imageRect.width-wantedWidth;this.crop.style.left=Math.round(diff/2).toString()+"px",this.crop.style.width=Math.round(wantedWidth).toString()+"px"}}setImage(){this.image.addEventListener("load",(()=>{this.initCrop(),this.emitImage()})),this.image.src=this.canvas.toDataURL()}handleNewFile(file){if("image"==file.type.split("/")[0]){this.fileName=file.name;var reader=new FileReader;reader.onload=readerLoadEvent=>{var img=new Image;img.onload=()=>{(this.canvas.width=img.width,this.canvas.height=img.height,this.preventUndersized&&(img.width<this.width||img.height<this.height))?this.imageTooSmallModal.show():(this.canvas.getContext("2d").drawImage(img,0,0),requestAnimationFrame((()=>{this.setView("hasPictureView")})),requestAnimationFrame((()=>{this.setImage()})),requestAnimationFrame((()=>{this.initializeCropBox()})))},img.src=readerLoadEvent.target.result.toString()},reader.readAsDataURL(file)}}emitImage(){var _a,_b,x=this.crop.offsetLeft/this.image.width*this.image.naturalWidth,y=this.crop.offsetTop/this.image.height*this.image.naturalHeight,cropRect=this.crop.getBoundingClientRect(),width=cropRect.width/this.image.width*this.image.naturalWidth,height=cropRect.height/this.image.height*this.image.naturalHeight;x<0&&(x=0),x>this.image.naturalWidth&&(x=this.image.naturalWidth),y<0&&(y=0),y>this.image.naturalWidth&&(y=this.image.naturalWidth),width>this.image.naturalWidth&&(width=this.image.naturalWidth),height>this.image.naturalHeight&&(height=this.image.naturalHeight);var dataUrl=this.generateCroppedImage(x,y,width,height,null!==(_a=this.width)&&void 0!==_a?_a:width,null!==(_b=this.height)&&void 0!==_b?_b:height);this.imageCropChanged.emit(dataUrl);var file=function dataURLtoFile(dataUrl,filename){let dataUrlParts=dataUrl.split(","),mime=dataUrlParts[0].match(/:(.*?);/)[1],binaryString=atob(dataUrlParts[1]),length=binaryString.length,u8arr=new Uint8Array(length);for(;length>0;)length--,u8arr[length]=binaryString.charCodeAt(length);let blob=new Blob([u8arr],{type:mime});return new File([blob],filename,{type:mime})}(dataUrl,this.fileName);if(this.imageFileCropChanged.emit(file),null!=this.name){var data=new FormData;data.append(this.name,file),this.internals.setFormValue(data)}}generateCroppedImage(x,y,width,height,desiredWidth,desiredHeight){this.canvas.width=desiredWidth,this.canvas.height=desiredHeight;const context=this.canvas.getContext("2d");return context.clearRect(0,0,desiredWidth,desiredHeight),context.drawImage(this.image,x,y,width,height,0,0,desiredWidth,desiredHeight),this.canvas.toDataURL("image/jpeg",this.quality)}isMouseStillInTarget(event){var inside=!1;let mouseX,mouseY;const imageRect=this.image.getBoundingClientRect();if(event instanceof MouseEvent&&(mouseX=event.clientX,mouseY=event.clientY),"undefined"!=typeof TouchEvent&&event instanceof TouchEvent){var touch=event.touches[0];mouseX=touch.clientX,mouseY=touch.clientY}return mouseX>=imageRect.x&&mouseY>=imageRect.y&&mouseX<=imageRect.left+imageRect.width&&mouseY<=imageRect.top+imageRect.height&&(inside=!0),this.crop.querySelectorAll("div").forEach((corner=>{var cornerRect=corner.getBoundingClientRect();mouseX>=cornerRect.x&&mouseY>=cornerRect.y&&mouseX<=cornerRect.left+cornerRect.width&&mouseY<=cornerRect.top+cornerRect.height&&(inside=!0)})),inside}render(){var _a,_b;return(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.H,{key:"381246ee476b95d7869bbdaef99e4032aabefb3a",tabIndex:this.focused?-1:0,onFocus:()=>this.inputField.focus(),onBlur:()=>this.inputField.blur()},(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("canvas",{key:"86c84108ff8438cc20e840d6f6ea14597b547c7f",ref:el=>this.canvas=el}),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"709fcd6dbd4385a3b46b7621367a3448aa3aee30",class:"view",ref:el=>this.hasPictureView=el},(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"d5ebd8b8ba823e62d6702254fcd4bd5d57439fe3",class:"cropper"},(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("img",{key:"85c591654d1c794be00067d105b04e09d7219d7c",ref:el=>this.image=el}),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"e21d5065734dddac7093b51c409fcd452ed079c6",class:"backdrop"}),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"72ae44e6cbdcc1ac76751fb82a7be59eed5bb5d1",class:"crop",ref:e=>this.crop=e,onMouseDown:this.handleCropMouseDown,onTouchStart:this.handleCropMouseDown},(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"1da722312999868d8c47af1608f918cbf4478713",class:"nw"}),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"4e5fb43ff7e69bf8b498391317df0fc5716d2999",class:"ne"}),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"4b2eba3a46f7514b3d9e446d6dc27d6102554fd4",class:"se"}),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"eb92e846bdbd2409ead0d4339f30c6d78b0e1225",class:"sw"})))),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{key:"2cf6c91c1b5cb2517f84e5c39548be4213fc27c2",class:"view",ref:el=>this.noPictureView=el},(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("dnn-dropzone",{key:"c9c2e904842f8462b87952836fa864a9e09079f2",allowCameraMode:!0,onFilesSelected:e=>this.handleNewFile(e.detail[0]),allowedExtensions:["jpg","jpeg","gif","png","svg","webp","bmp"],resx:{capture:this.localResx.capture,dragAndDropFile:this.localResx.dragAndDropFile,or:this.localResx.or,takePicture:this.localResx.takePicture,uploadFile:this.localResx.uploadFile,uploadSizeTooLarge:"The file you tried to upload is too large.",fileSizeLimit:"The maximum size is"},ref:el=>this.inputField=el,onFocus:()=>this.focused=!0,onBlur:()=>this.focused=!1})),(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("dnn-modal",{key:"d70385ac62db570303947cd133a6dace89851fe3",ref:el=>this.imageTooSmallModal=el,"close-text":this.localResx.modalCloseText},(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.h)("p",{key:"c96b96c98b7a7918b0f954323cb30146ead874a3"},this.localResx.imageTooSmall.replace("{width}",null===(_a=this.width)||void 0===_a?void 0:_a.toString()).replace("{height}",null===(_b=this.height)||void 0===_b?void 0:_b.toString()))))}static get formAssociated(){return!0}get host(){return(0,_index_9dbb7028_js__WEBPACK_IMPORTED_MODULE_0__.g)(this)}static get watchers(){return{resx:["resxChanged"]}}};DnnImageCropper.style=":host{display:block}canvas{display:none}.view{visibility:hidden;opacity:0;height:0;overflow:hidden;transition:all 300ms ease-in-out}.view.visible{visibility:visible;opacity:1;height:initial;overflow:visible}.view .cropper{position:relative;width:100%}.view .cropper img{width:100%;display:block;margin:0 auto}.view .cropper .backdrop{backdrop-filter:saturate(0.5);backdrop-filter:brightness(0.5);position:absolute;left:0;top:0;width:100%;height:100%}.view .cropper .crop{position:absolute;top:0;left:0;width:100%;height:100%;outline:2px dashed white;box-shadow:black 0 0 0px 2px;backdrop-filter:saturate(2);backdrop-filter:brightness(2);cursor:move}.view .cropper .crop>div{width:20px;height:20px;background-color:white;border:2px solid rgba(0, 0, 0, 0.5);position:absolute}.view .cropper .crop>div.nw,.view .cropper .crop>div.ne{top:-17px}.view .cropper .crop>div.ne,.view .cropper .crop>div.se{right:-17px}.view .cropper .crop>div.se,.view .cropper .crop>div.sw{bottom:-17px}.view .cropper .crop>div.sw,.view .cropper .crop>div.nw{left:-17px}.view .cropper .crop>div.nw,.view .cropper .crop>div.se{cursor:nwse-resize}.view .cropper .crop>div.ne,.view .cropper .crop>div.sw{cursor:nesw-resize}dnn-modal{--max-width:512px}"},"./dist/esm/mouseUtilities-e70a0dc3.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getMovementFromEvent(event,previousTouch){let movementX=0,movementY=0;if(event instanceof MouseEvent&&(movementX=event.movementX,movementY=event.movementY),"undefined"!=typeof TouchEvent&&event instanceof TouchEvent){let touch=event.touches[0];null!=previousTouch&&(movementX=touch.pageX-this.previousTouch.pageX,movementY=touch.pageY-this.previousTouch.pageY),previousTouch=touch}return{movementX,movementY}}__webpack_require__.d(__webpack_exports__,{g:()=>getMovementFromEvent})}}]);